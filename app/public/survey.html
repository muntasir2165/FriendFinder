<!DOCTYPE html>
<html lang="en-us">

	<head>

		<meta charset="UTF-8">
	 	<title>FriendFinder</title>
	 	<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Favicon for the webpage -->
	 	<link rel="icon" href="assets/images/friend-finder.png" type="image/png" sizes="16x16">

		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">

		<!-- jQuery library -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

		<!-- Popper JS -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>

		<!-- Latest compiled JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>

		<!-- Font Awesome icon library -->
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">

		<!-- <link rel="stylesheet" type="text/css" href="assets/css/style.css"> -->
		<style>
			#match-photo_url {
				max-width:100%;
				max-height:100%;
			}
		</style>
	</head>

	<body class="text-center">

		<div class="container">

			<div class="row">
				<div class="col-md-12">
					<h1>Survey Questions</h1>
				</div>	
			</div>

			<hr>

			<div class="row">
				<div class="col-md-8 offset-md-2 offset-md-right-2">
					<h3 class="section-name">About You</h3>
					<h5>Name (Required)</h5>
					<input type="text" id="name" class="form-control" placeholder="Joe Smith">
					<h5>Link to Photo Image (Required)</h5>
					<input type="text" id="photo_url" class="form-control" placeholder="https://cdn.pixabay.com/photo/2016/08/08/09/17/avatar-1577909__340.png">
				</div>	
			</div>

			<hr>

			<div class="row">
				<div class="col-md-12">
					<h3 class="section-name">Question 1</h3>
					<h5>Your mind is always buzzing with unexplored ideas and plans.</h5>
					<select class="answer-select" id="question-1">
					<option value="">Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="3">4</option>
					<option value="1">5 (Strongly Agree)</option>
					</select>
					<br><br>

					<h3 class="section-name">Question 2</h3>
					<h5>Generally speaking, you rely more on your experience than your imagination.</h5>
					<select class="answer-select" id="question-2">
					<option value="">Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="3">4</option>
					<option value="1">5 (Strongly Agree)</option>
					</select>
					<br><br>

					<h3 class="section-name">Question 3</h3>
					<h5>You find it easy to stay relaxed and focused even when there is some pressure.</h5>
					<select class="answer-select" id="question-3">
					<option value="">Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="3">4</option>
					<option value="1">5 (Strongly Agree)</option>
					</select>
					<br><br>

					<h3 class="section-name">Question 4</h3>
					<h5>You rarely do something just out of sheer curiosity.</h5>
					<select class="answer-select" id="question-4">
					<option value="">Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="3">4</option>
					<option value="1">5 (Strongly Agree)</option>
					</select>
					<br><br>

					<h3 class="section-name">Question 5</h3>
					<h5>People can rarely upset you.</h5>
					<select class="answer-select" id="question-5">
					<option value="">Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="3">4</option>
					<option value="1">5 (Strongly Agree)</option>
					</select>
					<br><br>

					<h3 class="section-name">Question 6</h3>
					<h5>It is often difficult for you to relate to other people’s feelings.</h5>
					<select class="answer-select" id="question-6">
					<option value="">Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="3">4</option>
					<option value="1">5 (Strongly Agree)</option>
					</select>
					<br><br>

					<h3 class="section-name">Question 7</h3>
					<h5>In a discussion, truth should be more important than people’s sensitivities.</h5>
					<select class="answer-select" id="question-7">
					<option value="">Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="3">4</option>
					<option value="1">5 (Strongly Agree)</option>
					</select>
					<br><br>

					<h3 class="section-name">Question 8</h3>
					<h5>You rarely get carried away by fantasies and ideas.</h5>
					<select class="answer-select" id="question-8">
					<option value="">Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="3">4</option>
					<option value="1">5 (Strongly Agree)</option>
					</select>
					<br><br>

					<h3 class="section-name">Question 9</h3>
					<h5>You think that everyone’s views should be respected regardless of whether they are supported by facts or not.</h5>
					<select class="answer-select" id="question-9">
					<option value="">Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="3">4</option>
					<option value="1">5 (Strongly Agree)</option>
					</select>
					<br><br>

					<h3 class="section-name">Question 10</h3>
					<h5>You feel more energetic after spending time with a group of people.</h5>
					<select class="answer-select" id="question-10">
					<option value="">Select an Option</option>
					<option value="1">1 (Strongly Disagree)</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="3">4</option>
					<option value="1">5 (Strongly Agree)</option>
					</select>
					<br>

				<button type="submit" class="mt-3 btn btn-primary btn-lg btn-block" id="submit"><i class="fa fa-check-circle" aria-hidden="true"></i> Submit</button>

				</div>	
			</div>

			<hr>

			<div class="row">
				<div class="col-md-12">
					<h5><a href="/api/friends" target="_blank">API Friends List</a> | <a href="https://github.com/muntasir2165/FriendFinder" target="_blank">GitHub Repo</a></h5>
				</div>
			</div>	


		</div>

		<!-- The friend match Modal -->
		<div class="modal fade" id="results-modal">
			<div class="modal-dialog">
				<div class="modal-content">

					<div class="modal-header">
						<h2 class="modal-title m-auto">Best Match for Friend</h2>
					</div>

					<div class="modal-body">
						<h2 id="match-name"></h2>
						<img id="match-photo_url" src="http://getdrawings.com/img/silhouette-avatar-12.png" alt="">
					</div>

					<div class="modal-footer">
						<button type="button" class="btn btn-danger m-auto" data-dismiss="modal">Close</button>
					</div>

				</div>
			</div>
		</div>

		<!-- Load the associated JavaScript files -->
		<!-- <script type="text/javascript" src="assets/javascript/app.js"></script> -->
		<script>
			$(document).ready(function() {
				submitButtonPressClickListener();
				// fillOutPageForTesting();
			});

			function fillOutPageForTesting() {
				$("#name").val("Joe Smith");
			    $("#photo_url").val("http://www.personalbrandingblog.com/wp-content/uploads/2017/08/blank-profile-picture-973460_640-300x300.png");
			    for(var i=1; i < 11; i++) {
					var id = "#question-" + i; 
					$(id).val("2");
				}
			}

			function isUserInfoInputFilledIn() {
				var name = $("#name").val();
			    var photo_url = $("#photo_url").val();
			    if (!name || !photo_url) {
			    	return false;
			    }
			    return true;
			}

			function clearUserInfoInputs() {
				$("#name").val("");
			    $("#photo_url").val("");
			}

			function isSurveyFilledIn() {
				for(var i=1; i < 11; i++) {
					var id = "#question-" + i;
					// console.log(id); 
					if (!$(id).val()) {
						// console.log($(id) + " value: " + $(id).val());
						return false;
					}
				}
				return true;
			}

			function clearSurvey() {
				for(var i=1; i < 11; i++) {
					var id = "#question-" + i; 
					$(id).val("");
				}
			}

			function alertUser(message) {
				alert(message);
			}

			function getSurveyData() {
				var scores = [];
				for(var i=1; i < 11; i++) {
					var id = "#question-" + i;
					if ($(id).val().includes("1") || $(id).val().includes("5")) {
						scores.push($(id).val()[0]);
					} else {
						scores.push($(id).val());
					}
				}
				return scores;
			}

			function getUserData() {
				var userData = {};
				userData["name"] = $("#name").val();
				userData["photo_url"] = $("#photo_url").val();
				userData["scores"] = getSurveyData();
				return userData;
			}

			function postUserDataToServer() {
				$.ajax({
					method: "POST",
					url: "/api/friends",
					data: getUserData(),
					// contentType: "application/json; charset=utf-8",
					// dataType: "json",
					success: function(result) {
						console.log(result);
						// Grab the result from the AJAX post so that the best friend match's name and photo are displayed.
						$("#match-name").text(result.name);
						$("#match-photo_url").attr("src", result.photo_url);

						// Show the modal with the best match
						$("#results-modal").modal("toggle");
					},
					error: function(XMLHttpRequest, textStatus, errorThrown) {
						alert("Sorry, invalid request.");
						console.log("textStatus: " + textStatus + " errorThrown: " + errorThrown);
						}
				});
			}

			function submitButtonPressClickListener() {
				$("#submit").on("click", function(event) {
					event.preventDefault();
					if (!isUserInfoInputFilledIn()  && !isSurveyFilledIn()) {
						alertUser("Please fill out your personal info and answer the survey questions before submitting the form");
					} else if (!isUserInfoInputFilledIn()) {
						alertUser("Please fill out your personal info before submitting the form");
					} else if (!isSurveyFilledIn()) {
						alertUser("Please answer the survey questions before submitting the form");
					} else {
						postUserDataToServer();
						clearUserInfoInputs();
						clearSurvey();
					}
				});
			}	
		</script>

	</body>

</html>